<!DOCTYPE html>
<meta charset="utf-8">

<body>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script src="https://rawgit.com/Anujarya300/bubble_maps/master/data/geography-data/datamaps.none.js"></script>
    <div id="canary-islands" style="height: 700px; width: 500px; float: left"></div>
    <div id="esp" style="height: 950px; width: 1000px; float: left"></div>
    <script>
        var bubble_canary_islands_map = new Datamap({
            element: document.getElementById('canary-islands'),
            scope: 'canary-islands',
            geographyConfig: {
                popupOnHover: true,
                highlightOnHover: true,
                borderColor: '#444',
                borderWidth: 0.5,
                dataUrl: 'https://raw.githubusercontent.com/cvazquezlos/d3-spain-dataset/master/spain-map-project/assets/canary-islands.topo.json'
                //dataJson: topoJsonData
            },
            fills: {
                'SOUTH': '#4CAF50',
                'NORTH': '#FFEB3B',
                'CENTER': '#2196F3',
                'EAST': '#9C27B0',
                'CAT': '#FF9800',
                'CAN': '#F44336',
                'MAJOR': '#306596',
                'MEDIUM': '#0fa0fa',
                'MINOR': '#bada55',
                defaultFill: '#dddddd'
            },
            data: {
                'CI': {
                    fillKey: 'CAN'
                }
                
            },
            setProjection: function(element) {
                var projection = d3.geo.mercator()
                    .center([-12, 32]) // always in [East Latitude, North Longitude]
                    .scale(4000);
                var path = d3.geo.path().projection(projection);
                return {
                    path: path,
                    projection: projection
                };
            }
        });
        var bubble_map = new Datamap({
            element: document.getElementById('esp'),
            scope: 'esp',
            geographyConfig: {
                popupOnHover: true,
                highlightOnHover: true,
                borderColor: '#444',
                borderWidth: 0.5,
                dataUrl: 'https://raw.githubusercontent.com/cvazquezlos/d3-spain-dataset/master/spain-map-project/assets/esp.topo.json'
                //dataJson: topoJsonData
            },
            fills: {
                'SOUTH': '#4CAF50',
                'NORTH': '#FFEB3B',
                'CENTER': '#2196F3',
                'EAST': '#795548',
                'CAT': '#FF9800',
                'CAN': '#F44336',
                'MAJOR': '#306596',
                'MEDIUM': '#0fa0fa',
                'MINOR': '#bada55',
                defaultFill: '#dddddd'
            },
            data: {
                'PV': { // NORTH
                    fillKey: 'NORTH'
                },
                'AS': {
                    fillKey: 'NORTH'
                },
                'AR': {
                    fillKey: 'NORTH'
                },
                'NA': {
                    fillKey: 'NORTH'
                },
                'GA': {
                    fillKey: 'NORTH'
                },
                'LO': {
                    fillKey: 'NORTH'
                },
                'CB': {
                    fillKey: 'NORTH'
                },
                'AN': { // SOUTH
                    fillKey: 'SOUTH'
                },
                'EX': {
                    fillKey: 'SOUTH'
                },
                'CE': {
                    fillKey: 'SOUTH'
                },
                'CM': { // CENTER
                    fillKey: 'CENTER'
                },
                'CL': {
                    fillKey: 'CENTER'
                },
                'MD': {
                    fillKey: 'CENTER'
                },
                'VC': { // EAST
                    fillKey: 'EAST'
                },
                'MU': {
                    fillKey: 'EAST'
                },
                'CT': { // CAT
                    fillKey: 'CAT'
                },
                'PM': {
                    fillKey: 'CAT'
                }
            },
            setProjection: function(element) {
                var projection = d3.geo.mercator()
                    .center([-3.0, 42.433429]) // always in [East Latitude, North Longitude]
                    .scale(4000);
                var path = d3.geo.path().projection(projection);
                return {
                    path: path,
                    projection: projection
                };
            }
        });
        let canaryBubbles = []
        let bubbles = []
        // // ISO ID code for city or <state></state>
        setTimeout(() => { // only start drawing bubbles on the map when map has rendered completely.
            bubble_map.bubbles(bubbles, {
                popupTemplate: function(geo, data) {
                    return `<div class="hoverinfo">city: ${data.state}, Slums: ${data.radius}%</div>`;
                }
            });
            bubble_canary_islands_map.bubbles(canaryBubbles, {
                popupTemplate: function(geo, data) {
                    return `<div class="hoverinfo">city: ${data.state}, Slums: ${data.radius}%</div>`;
                }
            });
        }, 1000);

    </script>
</body>
